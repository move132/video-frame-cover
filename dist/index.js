var c=class{constructor(t){let{url:e,currentTime:i=1,quality:n,imgWidth:s,imageType:o="image/jpeg",isCheckBackgroundColor:r=!1,success:a}=t;e||console.warn("\u89C6\u9891\u94FE\u63A5\u4E0D\u80FD\u4E3A\u7A7A"),this.url=e,this.video=null,this.videoWidth=0,this.imageType=o,this.quality=n?n>.2?n:.2:.95,this.imgWidth=s,this.currentTime=i<1?1:i,this.isCheckBackgroundColor=r,this.duration=0,this.success=a,this.getVideoFrame()}getVideoFrame(){let t=this,e=this.video||document.createElement("video"),i=t.currentTime;e.src=t.url,e.style.cssText="position: fixed; top: -100%; left: -100%; width: 400px; display: none; visibility: hidden;",e.controls=!0,e.crossOrigin="Anonymous",e.currentTime=i,e.addEventListener("timeupdate",()=>{this.setVideoInfo(),this.currentTime<=this.duration?this.generateCanvas():this.nextFrame()}),this.video=e,document.body.appendChild(e)}setVideoInfo(){let t=this.video;this.videoWidth=t.videoWidth,this.videoHeight=t.videoHeight,this.duration=Math.floor(t.duration||0)}appointFrame(t){if(!this.video){console.warn("\u8BF7\u5148\u521D\u59CB\u5316");return}let e=this.duration;t=t>e?e:t,this.currentTime=t,this.video.currentTime=t}previousFrame(){let t=this.currentTime;this.currentTime!==0&&(t--,this.appointFrame(t))}nextFrame(){let t=this.duration,e=this.currentTime;this.currentTime!==t&&(e++,this.appointFrame(e))}generateCanvas(){if(!this.video){console.warn("\u8BF7\u5148\u521D\u59CB\u5316");return}let t=this,e=this.canvas||document.createElement("canvas"),i=e.getContext("2d",{alpha:!1}),n=this.imgWidth,s=this.isCheckBackgroundColor,o=this.videoWidth,r=this.videoHeight;if(this.canvas||(n&&(r=n/(o/r),o=n),e.width=o,e.height=r),i==null||i.drawImage(this.video,0,0,e.width,e.height),s&&!this.checkImage(i,o,r)){this.nextFrame();return}let a=e.toDataURL(this.imageType,t.quality);this.success&&this.success(a,this.video)}checkImage(t,e,i){let s=t.getImageData(0,0,e,i).data,o={},r=0;for(let a=0,d=s.length;a<d;a+=4){let h=s.slice(a,a+4).join("");if(o[h]||(o[h]=1,r++),r>100)return!0}return!1}base64ToBlob(t){if(!t){console.warn("base64\u4E0D\u80FD\u4E3A\u7A7A");return}let e=t.split(";base64,"),i=e[0].split(":")[1],n=window.atob(e[1]),s=n.length,o=new Uint8Array(s);for(let r=0;r<s;++r)o[r]=n.charCodeAt(r);return new Blob([o],{type:i})}downloadFile(t){let e=Date.now();if(!t){console.warn("base64\u4E0D\u80FD\u4E3A\u7A7A");return}let i=document.createElement("a"),n=this.base64ToBlob(t);if(!n)return;document.createEvent("HTMLEvents").initEvent("click",!0,!0),i.download=e+"",i.href=URL.createObjectURL(n),i.click()}};function l(u){return new c(u)}typeof window<"u"&&(window.VideoFrameCover=l);export{l as default};
